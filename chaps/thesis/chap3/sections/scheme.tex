% !TEX root = ../chap3.tex

\section{Schémas numériques}

\subsection{Méthode de \emph{splitting} haniltonien}

Nous utilisons ici une méthode de \emph{splitting} hamiltonien. Pour le modèle $1dz -- 3dv$ celui-ci se décompose en 4 étapes, et il s'écrit sous la forme :
\begin{equation}
  \begin{aligned}
    & \partial_t U = \{ U,\mathcal{H}_{j_c}\} + \{ U,\mathcal{H}_B\} + \{ U,\mathcal{H}_E\} + \{ U,\mathcal{H}_{f_h}\} \\
    & U(t=0) = U_0
  \end{aligned}
  \label{eq:hamsplitting}
\end{equation}

Nous allons nous intéresser au calcul de $\varphi_t^{[j_c]}$, $\varphi_t^{[B]}$, $\varphi_t^{[E]}$ et $\varphi_t^{[f_h]}$ les solutions correspondant à chaque étape de sorte que $\varphi(U_0)$ de~\eqref{eq:hamsplitting} peut être approximé au temps $t$ avec une composition des sous-flux $\varphi_t^{[j_c,B,E,f_h]}$.

\paragraph{Étape $\mathcal{H}_{j_c}$ :\\}

Pour obtenir $\varphi_t^{[j_c]}$, solution du sous-flux $\mathcal{H}_{j_c}$ :
$$
  \begin{cases}
    \partial_t j_{c,\perp} &= -Jj_{c,\perp}B_0 \\
    \partial_t B_\perp     &= 0 \\
    \partial_t E_\perp     &= -j_{c,\perp} \\
    \partial_t f_h         &= 0
  \end{cases}
$$
nous calculons :
$$
  \varphi_t^{[j_c]}(U_0) = \begin{pmatrix}
    e^{-tJ}j_{c,\perp}(0)B_0 \\
    E_\perp(0) - J\left(e^{-tJ}-I\right)j_{c,\perp}(0) \\
    B_\perp(0) \\
    f_h(0)
  \end{pmatrix}
$$
Cela s'obtient car $\int_0^t \exp(-sJ)j_{c,\perp}(0)\,\mathrm{d}s = J\left(\exp(-tJ)-I\right)j_{c,\perp}(0)$.


\paragraph{Étape $\mathcal{H}_B$ :\\}
Nous souhaitons calculer $\varphi_t^{[B]}$, correspondant à la solution du système :
$$
  \begin{cases}
    \partial_t j_{c,\perp} &= 0 \\
    \partial_t B_\perp     &= 0 \\
    \partial_t E_\perp     &= -J\partial_zB_\perp \\
    \partial_t f_h         &= 0
  \end{cases}
$$
qui s'obtient de la manière suivante :
$$
  \varphi_t^{[B]}(U_0) = \begin{pmatrix}
    j_{c,\perp}(0) \\
    E_\perp(0) - tJ\partial_zB_\perp(0) \\
    B_\perp(0) \\
    f_h(0)
  \end{pmatrix}
$$


\paragraph{Étape $\mathcal{H}_E$ :\\}
Pour calculer la solution du sous-flux correspondant à $\mathcal{H}_E$, nous devons résoudre le système suivant :
$$
  \begin{cases}
    \partial_t j_{c,\perp} &= \Omega_{pe}^2E_{perp} \\
    \partial_t B_\perp     &= J\partial_zE_\perp \\
    \partial_t E_\perp     &= (0,0)^\mathsf{T} \\
    \partial_t f_h         &= E_\perp\cdot\nabla_{v_\perp}f_h
  \end{cases}
$$

Avec la conition initiale donnée par $U(t=0)=U_0=(j_{c,\perp},B_\perp,E_\perp,f_h)(t=0)$, la solution au temps $t$ est obtenue par :
$$
  \varphi_t^{[E]}(U_0) = \begin{pmatrix}
    j_{c,\perp} + t\Omega_{pe}^2E_\perp(0)\\
    B_\perp(0)+tJ\partial_zE_\perp(0) \\
    E_\perp(0) \\
    f_h(0,z,v_\perp+tE_\perp(0),v_z)
  \end{pmatrix}
$$
Le calcul de $f_h(0,z,v_\perp+tE_\perp(0),v_z)$ s'effectue en utilisant deux interpolations polynomiale de Lagrange d'ordre 5 à une dimension (une dans la direction $v_x$ et une autre dans la direction $v_y$).

\paragraph{Étape $\mathcal{H}_{f_h}$ :\\}

Pour la dernière étape, nous devons calculer une solution du sous-système :
$$
  \begin{cases}
    \partial_t  j_{c,\perp} &= 0 \\
    \partial_t B_\perp      &= 0 \\
    \partial_t E_\perp      &= \int v_\perp f_h\,\mathrm{d}v\\
    \partial_t f_h          &= -v_z\partial_zf_h + (v_yB_0-v_zB_y)\partial_{v_x}f_h + (-v_xB_0+v_zB_x)\partial_{v_y}f_h + (v_xB_y - v_yB_x)\partial_{v_z}f_h
  \end{cases}
$$
Comme pour la résolution de l'équation de Vlasov-Maxwell (\ref{Li:2019}), ce système ne peut être résolu exactement en temps. Mais en suivant \ref{Li:2019}, nous pouvons subdiviser encore l'hamiltonien $\mathcal{H}_{f_h}$ en $\mathcal{H}_{f_h}=\mathcal{H}_{f_{h,x}}+\mathcal{H}_{f_{h,y}}\mathcal{H}_{f_{h,z}}$, où $\mathcal{H}_{f_{h,\star}}=\frac{1}{2}\int v_{\star}^2 f_h\,\mathrm{d}\textbf{v}$, où $\star=x,y,z$. Cela condtuit à résoudre des sous-système suivant :
\begin{itemize}
  \item $\mathcal{H}_{f_{h,x}}$ :
  \item $\mathcal{H}_{f_{h,y}}$ :
  \item $\mathcal{H}_{f_{h,z}}$ :
\end{itemize}
 
\subsection{Méthode de Lawson sur le modèle hybride}

Dans cette section nous allons présenter la méthode d'intégration exponentielle pour discrétiser le modèle $1dz-3dv$.

Il est naturel de réécrire le système sous la forme :
$$
  \partial_t U = LU + N(t,U)
$$

avec :
\begin{equation}
  L = \begin{pmatrix}
    0   & -B_0 & 0          &  0          &  \Omega_{pe}^2 & 0             & 0 \\
    B_0 &  0   & 0          &  0          &  0             & \Omega_{pe}^2 & 0 \\
    0   &  0   & 0          &  0          &  0             & \partial_z    & 0 \\
    0   &  0   & 0          &  0          & -\partial_z    & 0             & 0 \\
   -1   &  0   & 0          & -\partial_z &  0             & 0             & 0 \\
    0   & -1   & \partial_z &  0          &  0             & 0             & 0 \\
    0   &  0   & 0          &  0          &  0             & 0             & -v_z\partial_z \\
  \end{pmatrix},
  \quad
  N:t,U\mapsto \begin{pmatrix}
    0 \\
    0 \\
    0 \\
    0 \\
    \int v_x f \,\mathrm{d}v \\
    \int v_y f \,\mathrm{d}v \\
    E_{\perp}\cdot\nabla_{v_\perp} f - v\times B\nabla_v f
  \end{pmatrix}
  \label{eq:3:LNmaxwell}
\end{equation}
Mais le calcul de $e^{\tau L}$ nécessaire pour l'écriture du schéma de la méthode LRK n'est pas réalisable avec \sympy{} ou un autre logiciel de calcul formel. Cela vient de l'expression des valeurs propres, dépendant du temps ($\tau$) et de la discrétisation dans l'espace de Fourier des dérivées spatiales ($\partial_z \equiv ik$). Pour résoudre ce problème, il est décidé dans un premier temps d'intégrer la partie provenant des équations de Maxwell de $L$ dans la partie non-linéaire $N$. Ce qui nous mène à redéfinir $L$ et $N$ comme :
\begin{equation}
  L = \begin{pmatrix}
    0   & -B_0 & 0 &  0 &  \Omega_{pe}^2 & 0             & 0 \\
    B_0 &  0   & 0 &  0 &  0             & \Omega_{pe}^2 & 0 \\
    0   &  0   & 0 &  0 &  0             & 0             & 0 \\
    0   &  0   & 0 &  0 &  0             & 0             & 0 \\
   -1   &  0   & 0 &  0 &  0             & 0             & 0 \\
    0   & -1   & 0 &  0 &  0             & 0             & 0 \\
    0   &  0   & 0 &  0 &  0             & 0             & -v_z\partial_z \\
  \end{pmatrix},
  \quad
  N:t,U\mapsto \begin{pmatrix}
    0 \\
    0 \\
     ikE_y \\
    -ikE_x \\
    -ikB_y + \int v_x f \,\mathrm{d}v \\
     ikB_x + \int v_y f \,\mathrm{d}v \\
    E_{\perp}\cdot\nabla_{v_\perp} f - v\times B\nabla_v f
  \end{pmatrix}
  \label{eq:3:LNsmaxwell}
\end{equation}
Une logiciel de calcul formel, comme \sympy, permet d'obtenir $e^{\tau L}$ pour toute valeur $\tau\in\mathbb{R}$ :
$$
  e^{\tau L} \approx \begin{pmatrix}
    0.378 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.621 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
    0.378 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.621 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} & 0 & 0 &
    0.970 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.970 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
  - 0.970 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.970 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)}\\

  - 0.378 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.621 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
    0.378 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.621 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} & 0 & 0 &
    0.970 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.970 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
    0.970 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.970 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)}\\

  0 & 0 & 1.0 & 0 & 0 & 0\\
  0 & 0 & 0 & 1.0 & 0 & 0\\

  - 0.242 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.242 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
    0.242 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.242 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} & 0 & 0 &
    0.621 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.378 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
    0.621 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.378 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)}\\

  - 0.242 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.242 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
  - 0.242 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.242 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} & 0 & 0 &
  - 0.621 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.378 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
    0.621 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.378 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)}
  \end{pmatrix}
$$
\Josselin{Il semble compliqué de mettre la matrice $e^{\tau L}$ dans le document (et encore il s'agit d'une version après demande d'évaluation numérique de \sympy) ce que je peux proposer c'est juste l'allure de la matrice :
$$
  e^{\tau L} = \begin{pmatrix}
    * & * & 0 & 0 & * & * & 0 \\
    * & * & 0 & 0 & * & * & 0 \\
    0 & 0 & 1 & 0 & 0 & 0 & 0 \\
    0 & 0 & 0 & 1 & 0 & 0 & 0 \\
    * & * & 0 & 0 & * & * & 0 \\
    * & * & 0 & 0 & * & * & 0 \\
    0 & 0 & 0 & 0 & 0 & 0 & e^{-ikv_z\tau} \\
  \end{pmatrix}
$$
mais ne pas mettre du tout la matrice est aussi une alternative.
}
% $$
%   \begin{pmatrix}
%     0.378732187481834 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.621267812518167 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
%     0.378732187481834 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.621267812518167 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} & 0 & 0 &
%     0.970142500145332 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.970142500145332 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
%   - 0.970142500145332 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.970142500145332 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)}\\

%   - 0.378732187481834 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.621267812518166 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
%     0.378732187481834 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.621267812518167 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} & 0 & 0 &
%     0.970142500145332 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.970142500145332 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
%     0.970142500145332 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.970142500145332 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)}\\

%   0 & 0 & 1.0 & 0 & 0 & 0\\
%   0 & 0 & 0 & 1.0 & 0 & 0\\

%   - 0.242535625036333 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.242535625036333 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
%     0.242535625036333 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.242535625036333 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} & 0 & 0 &
%     0.621267812518166 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.378732187481834 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
%     0.621267812518167 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.378732187481834 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)}\\

%   - 0.242535625036333 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.242535625036333 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
%   - 0.242535625036333 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} - 0.242535625036333 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} & 0 & 0 &
%   - 0.621267812518166 \sin{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.378732187481834 \sin{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)} &
%     0.621267812518167 \cos{\left(\frac{\sqrt{2} \tau \sqrt{9 - \sqrt{17}}}{2} \right)} + 0.378732187481834 \cos{\left(\frac{\sqrt{2} \tau \sqrt{\sqrt{17} + 9}}{2} \right)}
%   \end{pmatrix}
% $$
C'est donc à partir de la matrice $L$ sans les termes provenant des équations de Maxwell, et avec le terme non-linéaire $N$, contenant les termes des équations de Maxwell, définis dans~\eqref{eq:3:LNsmaxwell}, que nous allons construire notre premier schéma de Lawson. Il est important d'avoir une formulation explicite de l'exponentielle de la partie linéaire pour construire un schéma en temps efficace. En effet le calcul numérique de l'exponentielle d'une matrice pour une valeur de $\tau$ et de $k$ données est élevé et ne peut être effectuer en amont de la simulation. Le calcul en amont de ces quantités impose une discrétisation en espace, et empêche la mise en place de méthodes à pas de temps adaptatif. Nous verrons par la suite, dans la section~\ref{s3:approx}, une méthode permettant d'intégrer les termes des équations de Maxwell dans la partie linéaire de la méthode de Lawson.

\subsubsection{Filtrage de l'équation de Vlasov}

L'équation de Vlasov contient le terme $(\vb{v}\times\vb{B}_0)$ qui introduit une condition de CFL restrictive qui peut être outrepassé en utilisant le changement de variable $w=e^{tB_0J}v$, avec $w=(w_x,w_y)^\top$ et $v=(v_x,v_y)^\top$, pour filtrer ce terme en influençant le moins possible le reste du système. Nous introduisons $g(t,z,w,v_z) = f_h(t,z,\exp(-tB_0J)w,v_z)$ avec :
$$
  e^{-tB_0J} = \begin{pmatrix}
    \cos(tB_0) & -\sin(tB_0) \\
    \sin(tB_0) &  \cos(tB_0)
  \end{pmatrix},
  \quad
  J = \begin{pmatrix}
    0  & 1 \\
    -1 & 0
  \end{pmatrix}
$$


\Josselin{Dans l'intro de la thèse, dans mon plan, j'ai une partie consacrée aux méthodes numériques, la méthode de Lawson sera sans doute plus présentée en détail là-bas (le schéma, comment construire une méthode de Lawson à partir d'une méthode RK, chose qui est déjà un peu faite dans le chapitre 1 dans \ref{butcher}). Donc je décide de ne pas m'attarder sur le schéma choisi etc. mais plutôt sur les différences par rapport à son utilisation simple dans les chapitres 1 et 2.}

\subsubsection{Calcul de stabilité avec les équations de Maxwell}

L'introduction des équations de Maxwell dans la partie non-linéaire de la méthode de Lawson, comme indiquée dans~\eqref{eq:3:LNsmaxwell}, implique une condition de stabilité provenant de ces termes.

Présenter la méthode où on s'intéresse à la CFL de Maxwell qu'avec $\dot{u} = A(u)$ avec $u\in\mathbb{R}^2$ et $A$ qui est une matrice qui contient juste la diagonale de $ik$ de Maxwell.

Présenter la méthode où on s'intéresse à la CFL du système complet de Lawson, dire que la partie linéaire mélange des trucs mais que l'estimation faite dans la résolution de $\dot{u} = A(u)$ est plutôt bonne.

